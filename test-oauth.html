<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .button { 
            display: inline-block; 
            padding: 10px 20px; 
            margin: 10px; 
            background: #f0f0f0; 
            border: 1px solid #ccc; 
            cursor: pointer; 
            text-decoration: none;
            color: #333;
        }
        .button:hover { background: #e0e0e0; }
        .button:disabled { 
            background: #f5f5f5; 
            color: #999; 
            cursor: not-allowed; 
        }
        .status { margin: 10px 0; padding: 10px; background: #f9f9f9; border-left: 4px solid #007cba; }
    </style>
</head>
<body>
    <h1>OAuth Button Test</h1>
    
    <div class="status">
        <strong>Test Status:</strong> <span id="status">Testing OAuth buttons...</span>
    </div>

    <h2>Test OAuth Buttons</h2>
    <button class="button" id="googleBtn" onclick="testGoogleAuth()">
        üîµ Google OAuth
    </button>
    
    <button class="button" id="githubBtn" onclick="testGitHubAuth()">
        üêô GitHub OAuth
    </button>

    <h2>Test Backend API</h2>
    <button class="button" onclick="testBackendHealth()">
        üè• Backend Health
    </button>
    
    <button class="button" onclick="testUserRegistration()">
        üë§ Test Registration
    </button>
    
    <button class="button" onclick="testUserLogin()">
        üîê Test Login
    </button>

    <div id="results"></div>

    <script>
        // OAuth Service Mock
        const GOOGLE_CLIENT_ID = 'test-google-client-id';
        const GITHUB_CLIENT_ID = 'test-github-client-id';
        const REDIRECT_URI = `${window.location.origin}/auth/callback`;

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function addResult(message, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.style.margin = '10px 0';
            div.style.padding = '10px';
            div.style.backgroundColor = isError ? '#ffe6e6' : '#e6ffe6';
            div.style.borderLeft = `4px solid ${isError ? '#ff4444' : '#44aa44'}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
        }

        function testGoogleAuth() {
            try {
                if (!GOOGLE_CLIENT_ID) {
                    addResult('‚ùå Google OAuth not configured', true);
                    return;
                }
                
                const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=email profile&state=google`;
                addResult(`‚úÖ Google OAuth URL generated: ${authUrl.substring(0, 100)}...`);
                
                // In a real test, this would redirect
                addResult('‚ÑπÔ∏è In a real test, this would redirect to Google OAuth');
            } catch (error) {
                addResult(`‚ùå Google OAuth error: ${error.message}`, true);
            }
        }

        function testGitHubAuth() {
            try {
                if (!GITHUB_CLIENT_ID) {
                    addResult('‚ùå GitHub OAuth not configured', true);
                    return;
                }
                
                const authUrl = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=user:email&state=github`;
                addResult(`‚úÖ GitHub OAuth URL generated: ${authUrl.substring(0, 100)}...`);
                
                // In a real test, this would redirect
                addResult('‚ÑπÔ∏è In a real test, this would redirect to GitHub OAuth');
            } catch (error) {
                addResult(`‚ùå GitHub OAuth error: ${error.message}`, true);
            }
        }

        async function testBackendHealth() {
            try {
                const response = await fetch('http://localhost:5000/health');
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ Backend is healthy: ${JSON.stringify(data)}`);
                } else {
                    addResult(`‚ùå Backend health check failed: ${response.status}`, true);
                }
            } catch (error) {
                addResult(`‚ùå Backend connection error: ${error.message}`, true);
            }
        }

        async function testUserRegistration() {
            try {
                const testEmail = `test-${Date.now()}@example.com`;
                const response = await fetch('http://localhost:5000/api/auth/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: testEmail,
                        password: 'password123',
                        firstName: 'Test',
                        lastName: 'User'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ User registration successful: ${data.email}`);
                } else {
                    const error = await response.json();
                    addResult(`‚ùå Registration failed: ${error.error}`, true);
                }
            } catch (error) {
                addResult(`‚ùå Registration error: ${error.message}`, true);
            }
        }

        async function testUserLogin() {
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'password123'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ User login successful: Token received (${data.token.substring(0, 20)}...)`);
                } else {
                    const error = await response.json();
                    addResult(`‚ùå Login failed: ${error.error}`, true);
                }
            } catch (error) {
                addResult(`‚ùå Login error: ${error.message}`, true);
            }
        }

        // Auto-run tests on page load
        window.onload = function() {
            updateStatus('Running initial tests...');
            testBackendHealth();
        };
    </script>
</body>
</html>
